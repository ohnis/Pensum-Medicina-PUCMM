<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Curricular Interactiva - Medicina</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .filtro-ciclos {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 1rem 0;
    }
    .filtro-ciclos button {
      padding: 8px 16px;
      border: none;
      background-color: #3399ff;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    .filtro-ciclos button.active {
      background-color: #004d99;
    }
  </style>
</head>
<body>
  <header>
    <h1>Malla Curricular Interactiva - Medicina</h1>
    <div class="progress-bar-container">
      <div id="progress-bar" class="progress-bar"></div>
      <span id="progress-text">0%</span>
    </div>
  </header>

  <!-- Filtro por ciclos -->
  <div class="filtro-ciclos">
    <button onclick="filtrarCiclo('Todos')" class="active">Todos</button>
    <button onclick="filtrarCiclo('Premédica')">Premédica</button>
    <button onclick="filtrarCiclo('Ciencias Médicas Básicas')">Ciencias Médicas Básicas</button>
    <button onclick="filtrarCiclo('Preinternado')">Preinternado</button>
    <button onclick="filtrarCiclo('Internado')">Internado</button>
  </div>

  <main id="grid-container"></main>

  <script src="script_pensum_ciclos_final.js"></script>
  <script>
    let cicloActual = 'Todos';

    function filtrarCiclo(ciclo) {
      cicloActual = ciclo;
      document.querySelectorAll('.filtro-ciclos button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.innerText === ciclo) btn.classList.add('active');
      });
      renderMaterias();
    }

    function renderMaterias() {
      const contenedor = document.getElementById("grid-container");
      contenedor.innerHTML = "";

      materias.forEach((materia) => {
        if (cicloActual !== 'Todos' && materia.ciclo !== cicloActual) return;

        const btn = document.createElement("div");
        btn.innerText = materia.nombre;
        btn.classList.add("course");

        const requisitosCumplidos = materia.requisitos.every((req) => aprobadas.has(req));
        if (!requisitosCumplidos && !aprobadas.has(materia.nombre)) {
          btn.classList.add("locked");
        } else if (aprobadas.has(materia.nombre)) {
          btn.classList.add("completed");
        }

        btn.onclick = () => {
          if (btn.classList.contains("locked")) return;
          if (aprobadas.has(materia.nombre)) {
            aprobadas.delete(materia.nombre);
          } else {
            aprobadas.add(materia.nombre);
          }
          renderMaterias();
          actualizarProgreso();
        };

        contenedor.appendChild(btn);
      });
    }

    renderMaterias();
    actualizarProgreso();
  </script>
</body>
</html>
